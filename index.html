<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¦³å…‰åœ°é¸æŠ</title>
    <style>
        /* ãƒšãƒ¼ã‚¸å…¨ä½“ã®è¨­å®š */
        body {
            margin: 0;
            width: 810px;
            height: 945px;
            background: #7accbf;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
            position: relative;
        }
        
        /* ã‚¿ã‚¤ãƒˆãƒ« */
        .title {
            margin-top: 50px;
            font-size: 28px;
            color: #fcf2e5;
            text-align: center;
            font-weight: bold;
            line-height: 1.3;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        /* ç”»åƒãƒšã‚¢è¡¨ç¤ºç”¨ã‚³ãƒ³ãƒ†ãƒŠ */
        .image-container {
            display: flex;
            justify-content: center;
            gap: 25px;
            width: 100%;
            margin-top: 60px
        }
        
        /* æ–°ã—ã„ç”»åƒç”¨ã‚³ãƒ³ãƒ†ãƒŠ:æœ€åˆã¯å®Œå…¨ã«éè¡¨ç¤º */
        .new-image-container {
            display: none;
            width: 100%;
            justify-content: center;
            align-items: center;
            margin-top: 20px
        }
        
        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ */
        .menu-button {
            position: absolute;
            bottom: 240px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 45px;
            background-color: white;
            border-radius: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
            font-size: 16px;
            font-weight: bold;
            color: #333;
            transition: transform 0.2s;
            border: none;
        }
        
        .menu-button:hover {
            transform: translateX(-50%) scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }
        
        /* ç”»åƒã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .image-container img {
            width: 280px;
            height: 210px;
            cursor: pointer;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: transform 0.3s ease;
            object-fit: cover;
        }
        
        .image-container img:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }
        
        .new-image-container img {
            width: 420px;
            height: 315px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            object-fit: cover;
        }
        
        /* ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ç”»åƒã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .placeholder {
            background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
        }
        
        .new-placeholder {
            background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 20px;
            font-weight: bold;
            text-align: center;
        }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 20px;
            color: #fcf2e5;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
    <div class="loading" id="loading">èª­ã¿è¾¼ã¿ä¸­...</div>

    <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
    <div class="title">
        ã‚ãªãŸãªã‚‰<br>
        ã©ã£ã¡ã®è¦³å…‰åœ°ã«è¡ŒããŸã„?
    </div>
    
    <!-- å…ƒã®ãƒšã‚¢ç”»åƒ -->
    <div class="image-container">
        <img id="image1" src="" alt="è¦³å…‰åœ°1" onclick="changeImage('left')" class="placeholder">
        <img id="image2" src="" alt="è¦³å…‰åœ°2" onclick="changeImage('right')" class="placeholder">
    </div>
    
    <!-- ã‚¯ãƒªãƒƒã‚¯å¾Œã«è¡¨ç¤ºã™ã‚‹æ–°ã—ã„ç”»åƒ -->
    <div class="new-image-container">
        <img id="newImage" src="" alt="é¸æŠã•ã‚ŒãŸè¦³å…‰åœ°" class="new-placeholder">
    </div>
    
    <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ -->
    <button class="menu-button" onclick="goToMenu()">
        ãƒ¡ãƒ‹ãƒ¥ãƒ¼
    </button>
    
    <script>
        // Google Apps Script Web App URL (ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®URLã«ç½®ãæ›ãˆã¦ãã ã•ã„)
        const API_URL = 'https://script.google.com/macros/s/AKfycbzZ0iVHCAwRe-Jq3eqwpQCE3NT8MpziRDDcLlcSYvz66k07dc3o4S79h0qWWQzchQ5FoA/exec';

        // ç”»åƒã®ãƒšã‚¢ã‚’é…åˆ—ã«æ ¼ç´(å…ƒã®2ã¤ã®ç”»åƒã®ã¿)
        const imagePairs = [
            ['images/term_photo1.jpg', 'images/term_photo2.jpg'],
            ['images/term_photo3.jpg', 'images/term_photo4.jpg'],
            ['images/term_photo5.jpg', 'images/term_photo6.jpg']
        ];
        
        // å„ãƒšã‚¢ã«å¯¾å¿œã™ã‚‹æ–°ã—ã„ç”»åƒ(çµæœè¡¨ç¤ºç”¨)
        const newImages = {
            0: 'images/new12.jpg',
            1: 'images/new34.jpg',
            2: 'images/new56.jpg'
        };
        
        let currentPairIndex = 0;
        let clickedSide = ''; // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸç”»åƒã®å´('left' or 'right')
        
        // çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã®åˆæœŸåŒ–
        let imageStats = {
            pair0: { left: 0, right: 0, leftImage: 'term_photo1.jpg', rightImage: 'term_photo2.jpg' },
            pair1: { left: 0, right: 0, leftImage: 'term_photo3.jpg', rightImage: 'term_photo4.jpg' },
            pair2: { left: 0, right: 0, leftImage: 'term_photo5.jpg', rightImage: 'term_photo6.jpg' }
        };
        
        // çµ±è¨ˆã‚’ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰èª­ã¿è¾¼ã‚€
        async function loadStats() {
            try {
                const response = await fetch(API_URL);
                if (response.ok) {
                    imageStats = await response.json();
                    console.log('âœ… ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰çµ±è¨ˆã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
                } else {
                    console.log('âš ï¸ ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰çµ±è¨ˆã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚åˆæœŸå€¤ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚');
                }
            } catch (e) {
                console.log('âš ï¸ ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šã‚¨ãƒ©ãƒ¼ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œã—ã¾ã™:', e);
            }
        }
        
        // çµ±è¨ˆã‚’ä¿å­˜(ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡) - ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«åã‚’é€ä¿¡
        async function saveVote(pairIndex, side) {
            // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«åã‚’å–å¾—
            const pairKey = `pair${pairIndex}`;
            const imageName = side === 'left' 
                ? imageStats[pairKey].leftImage 
                : imageStats[pairKey].rightImage;
            
            try {
                const url = `${API_URL}?pairIndex=${encodeURIComponent(pairIndex)}&imageName=${encodeURIComponent(imageName)}`;
                await fetch(url, {
                    method: 'POST',
                    mode: 'no-cors'
                });
                
                console.log('ğŸ’¾ æŠ•ç¥¨ã‚’ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã—ã¾ã—ãŸ:', imageName);
            } catch (e) {
                console.error('âŒ ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šã‚¨ãƒ©ãƒ¼:', e);
            }
        }
        
        // ãƒ©ãƒ³ãƒ€ãƒ ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ç”Ÿæˆ
        function getRandomIndex(max) {
            return Math.floor(Math.random() * max);
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ©ãƒ³ãƒ€ãƒ ãƒšã‚¢ã‚’è¡¨ç¤º
        function displayRandomImages() {
            currentPairIndex = getRandomIndex(imagePairs.length);
            const [src1, src2] = imagePairs[currentPairIndex];
            
            // ã‚¿ã‚¤ãƒˆãƒ«ã®æ›´æ–°
            const titleElement = document.querySelector('.title');
            if (currentPairIndex === 0) {
                titleElement.innerHTML = 'ã‚ãªãŸãªã‚‰<br>ã©ã£ã¡ã®ãƒ“ãƒ¼ãƒ«ãŒé£²ã¿ãŸã„?';
            } else {
                titleElement.innerHTML = 'ã‚ãªãŸãªã‚‰<br>ã©ã£ã¡ã®è¦³å…‰åœ°ã«è¡ŒããŸã„?';
            }
            
            const img1 = document.getElementById('image1');
            const img2 = document.getElementById('image2');
            
            // ç”»åƒèª­ã¿è¾¼ã¿å‡¦ç†
            img1.onload = function() {
                this.classList.remove('placeholder');
                this.style.background = 'none';
            };
            img1.onerror = function() {
                this.classList.add('placeholder');
                this.innerHTML = 'è¦³å…‰åœ°ç”»åƒ1';
                this.removeAttribute('src');
            };
            
            img2.onload = function() {
                this.classList.remove('placeholder');
                this.style.background = 'none';
            };
            img2.onerror = function() {
                this.classList.add('placeholder');
                this.innerHTML = 'è¦³å…‰åœ°ç”»åƒ2';
                this.removeAttribute('src');
            };
            
            // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆã‚’è¨­å®š
            img1.innerHTML = 'è¦³å…‰åœ°ç”»åƒ1';
            img2.innerHTML = 'è¦³å…‰åœ°ç”»åƒ2';
            
            img1.src = src1;
            img2.src = src2;
        }
        
        // ã‚¯ãƒªãƒƒã‚¯æ™‚:ã©ã¡ã‚‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‹è¨˜éŒ² â†’ æ–°ç”»åƒã‚’è¡¨ç¤º
        async function changeImage(side) {
            clickedSide = side;
            
            // ãƒ­ãƒ¼ã‚«ãƒ«ã®çµ±è¨ˆã‚’æ›´æ–°
            const pairKey = `pair${currentPairIndex}`;
            if (side === 'left') {
                imageStats[pairKey].left++;
            } else {
                imageStats[pairKey].right++;
            }
            
            // ã‚µãƒ¼ãƒãƒ¼ã«æŠ•ç¥¨ã‚’é€ä¿¡
            await saveVote(currentPairIndex, side);
            
            console.log('âœ… æŠ•ç¥¨ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ');
            console.log('ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸç”»åƒ:', clickedSide);
            console.log('é¸æŠã•ã‚ŒãŸãƒšã‚¢:', currentPairIndex);
            console.log('ç¾åœ¨ã®çµ±è¨ˆ:', imageStats[pairKey]);
            
            // å…ƒã®ç”»åƒãƒšã‚¢ã‚’éè¡¨ç¤ºã«ã—ã€æ–°ã—ã„ç”»åƒã‚’è¡¨ç¤º
            document.querySelector('.image-container').style.display = 'none';
            const newContainer = document.querySelector('.new-image-container');
            newContainer.style.display = 'flex';
            
            const newImg = document.getElementById('newImage');
            newImg.onload = function() {
                this.classList.remove('new-placeholder');
                this.style.background = 'none';
                this.innerHTML = '';
            };
            newImg.onerror = function() {
                this.classList.add('new-placeholder');
                this.innerHTML = 'é¸æŠã•ã‚ŒãŸ<br>è¦³å…‰åœ°ç”»åƒ';
                this.removeAttribute('src');
            };
            
            // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆã‚’è¨­å®š
            newImg.innerHTML = 'é¸æŠã•ã‚ŒãŸ<br>è¦³å…‰åœ°ç”»åƒ';
            newImg.src = newImages[currentPairIndex];
        }
        
        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
        function goToMenu() {
            document.querySelector('.image-container').style.display = 'flex';
            document.querySelector('.new-image-container').style.display = 'none';
            displayRandomImages();
        }
        
        // çµ±è¨ˆã‚’è¡¨ç¤º
        async function showStats() {
            try {
                // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰æœ€æ–°ã®çµ±è¨ˆã‚’å–å¾—
                const response = await fetch(API_URL);
                if (response.ok) {
                    imageStats = await response.json();
                }
            } catch (e) {
                console.error('âŒ çµ±è¨ˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
            }

            console.clear();
            console.log('='.repeat(70));
            console.log('ğŸ“Š è¦³å…‰åœ°ç”»åƒé¸æŠçµ±è¨ˆ(å…¨ãƒ–ãƒ©ã‚¦ã‚¶ãƒ»å…¨ãƒ‡ãƒã‚¤ã‚¹å…±æœ‰)');
            console.log('='.repeat(70));
            
            for (let i = 0; i < 3; i++) {
                const pairKey = `pair${i}`;
                const stats = imageStats[pairKey];
                const total = stats.left + stats.right;
                const leftPercent = total > 0 ? Math.round(stats.left / total * 100) : 0;
                const rightPercent = total > 0 ? Math.round(stats.right / total * 100) : 0;
                
                console.log(`\nã€ãƒšã‚¢${i + 1}ã€‘`);
                console.log('-'.repeat(60));
                console.log(`å·¦ã®ç”»åƒ: ${stats.leftImage}`);
                console.log(`  â†’ ${stats.left}äººãŒé¸æŠ (${leftPercent}%)`);
                console.log(`å³ã®ç”»åƒ: ${stats.rightImage}`);
                console.log(`  â†’ ${stats.right}äººãŒé¸æŠ (${rightPercent}%)`);
                console.log(`åˆè¨ˆ: ${total}äºº`);
            }
            
            console.log('\n' + '='.repeat(70));
            console.log('ğŸ’¡ çµ±è¨ˆã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹ã«ã¯ã€Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„');
            console.log('='.repeat(70));
            
            alert('çµ±è¨ˆã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤ºã—ã¾ã—ãŸã€‚\nF12ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
        }
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«é–¢æ•°ã‚’å…¬é–‹
        window.showStats = showStats;
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
        window.onload = async function() {
            const loading = document.getElementById('loading');
            
            try {
                await loadStats();
                displayRandomImages();
                loading.style.display = 'none';
                
                console.log('ğŸ“ è¦³å…‰åœ°é¸æŠã‚µã‚¤ãƒˆãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
                console.log('ğŸ’¡ çµ±è¨ˆã‚’è¦‹ã‚‹ã«ã¯ã€Œçµ±è¨ˆè¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„');
                console.log('ğŸ’¡ ã¾ãŸã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ showStats() ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„');
                console.log('ğŸŒ çµ±è¨ˆã¯å…¨ãƒ–ãƒ©ã‚¦ã‚¶ãƒ»å…¨ãƒ‡ãƒã‚¤ã‚¹ã§å…±æœ‰ã•ã‚Œã¾ã™');
            } catch (e) {
                console.error('âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', e);
                loading.textContent = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
            }
        };
    </script>
</body>
</html>


